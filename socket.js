const _0x518acf=_0x3ecd;(function(_0x1c5575,_0x5d37ac){const _0x11a88d=_0x3ecd,_0x6296d=_0x1c5575();while(!![]){try{const _0x28f4c8=parseInt(_0x11a88d(0x1a9))/0x1+parseInt(_0x11a88d(0x1c4))/0x2+-parseInt(_0x11a88d(0x1b9))/0x3+-parseInt(_0x11a88d(0x199))/0x4+parseInt(_0x11a88d(0x1a6))/0x5+parseInt(_0x11a88d(0x1ab))/0x6+-parseInt(_0x11a88d(0x1b7))/0x7*(-parseInt(_0x11a88d(0x1c8))/0x8);if(_0x28f4c8===_0x5d37ac)break;else _0x6296d['push'](_0x6296d['shift']());}catch(_0x5059d4){_0x6296d['push'](_0x6296d['shift']());}}}(_0x2d43,0x699ca));let fileStream,recordingFolder;const fs=require('fs'),path=require(_0x518acf(0x1ba)),siofu=require(_0x518acf(0x19d));function _0x3ecd(_0x181e2d,_0x54b845){const _0x2d432b=_0x2d43();return _0x3ecd=function(_0x3ecd6a,_0x54ad48){_0x3ecd6a=_0x3ecd6a-0x195;let _0x3bb149=_0x2d432b[_0x3ecd6a];return _0x3bb149;},_0x3ecd(_0x181e2d,_0x54b845);}function _0x2d43(){const _0x76f270=['path','clientDetail','existsSync','emit','extension','USER_LIMIT_PER_ROOM','write','userName','file','candidate','1076414DdevsP','broadcast','toSocketId','socketId','1352HhHYBt','chunk','adapter','checkRoomResult','sync','2865960OHKDik','username','dir','join','socketio-file-upload','Some\x20other\x20error:\x20','stringify','maxFileSize','rooms','disconnect','listen','message','sockets','419765cUbHCe','.webm','../file_uploads/','735118OLIJCn','connection','979458mTgSKB','code','offer','meta','type','env','ENOENT','from','leave','recordedChunk','saved','room','4445mYnZSh','length','1436280bsvsQs'];_0x2d43=function(){return _0x76f270;};return _0x2d43();}module['exports']=function(_0x3abfcc,_0x260480){const _0x3268aa=_0x518acf;recordingFolder=_0x260480,_0x3abfcc[_0x3268aa(0x1a5)]['on'](_0x3268aa(0x1aa),function(_0x1d0e0a){const _0x61fb35=_0x3268aa;_0x1d0e0a['on'](_0x61fb35(0x1b4),function(_0x5e9661){handleRecordedChunk(_0x5e9661);}),_0x1d0e0a['on'](_0x61fb35(0x1a4),function(_0xad9068){const _0x599245=_0x61fb35;_0xad9068=JSON['parse'](_0xad9068);switch(_0xad9068[_0x599245(0x1af)]){case _0x599245(0x19c):handleJoin(_0x1d0e0a,_0xad9068);break;case'checkRoom':handleCheckRoom(_0x1d0e0a,_0xad9068,_0x3abfcc);break;case _0x599245(0x1ad):case'answer':case _0x599245(0x1c3):sendToPeer(_0x3abfcc,_0xad9068);break;case'message':case'whiteboard':case'clearWhiteboard':case _0x599245(0x198):sendToRoom(_0x1d0e0a,_0xad9068);break;}}),_0x1d0e0a['on'](_0x61fb35(0x1a2),function(){handleDisconnect(_0x1d0e0a,_0x3abfcc);});});};function handleJoin(_0x829b1a,_0x3a547d){const _0x204d12=_0x518acf;_0x829b1a[_0x204d12(0x1b6)]=_0x3a547d['room'],_0x829b1a[_0x204d12(0x19c)](_0x3a547d[_0x204d12(0x1b6)]),_0x3a547d[_0x204d12(0x1c7)]=_0x829b1a['id'],sendToRoom(_0x829b1a,_0x3a547d),handleFileTransfer(_0x829b1a,_0x3a547d['room']);}function handleFileTransfer(_0x5f3f79,_0x29d80a){const _0x23334c=_0x518acf;var _0x1173e1=new siofu();_0x1173e1[_0x23334c(0x19b)]=path[_0x23334c(0x19c)](__dirname,_0x23334c(0x1a8)+_0x29d80a),!fs[_0x23334c(0x1bc)](_0x1173e1['dir'])&&fs['mkdirSync'](_0x1173e1[_0x23334c(0x19b)]),_0x1173e1[_0x23334c(0x1a0)]=process[_0x23334c(0x1b0)]['MAX_FILESIZE']*0x400*0x400,_0x1173e1[_0x23334c(0x1a3)](_0x5f3f79),_0x1173e1['on'](_0x23334c(0x1b5),function(_0x85be9a){const _0x17d182=_0x23334c;_0x85be9a[_0x17d182(0x1c2)][_0x17d182(0x1bb)][_0x17d182(0x1c2)]=_0x85be9a[_0x17d182(0x1c2)]['base'],_0x85be9a[_0x17d182(0x1c2)]['clientDetail'][_0x17d182(0x1be)]=_0x85be9a['file'][_0x17d182(0x1ae)][_0x17d182(0x1be)],_0x85be9a['file'][_0x17d182(0x1bb)][_0x17d182(0x19a)]=_0x85be9a['file'][_0x17d182(0x1ae)][_0x17d182(0x1c1)],sendToRoom(_0x5f3f79,{'type':'file','file':_0x85be9a[_0x17d182(0x1c2)]['base'],'extension':_0x85be9a[_0x17d182(0x1c2)][_0x17d182(0x1ae)]['extension'],'username':_0x85be9a[_0x17d182(0x1c2)][_0x17d182(0x1ae)][_0x17d182(0x19a)]});}),_0x1173e1['on']('error',function(_0x1eb106){});}function handleDisconnect(_0x382789,_0x314a20){const _0x4d2505=_0x518acf;let _0x35bc8f=path[_0x4d2505(0x19c)](__dirname,'../file_uploads/'+_0x382789[_0x4d2505(0x1b6)]);!_0x314a20[_0x4d2505(0x1a5)][_0x4d2505(0x196)][_0x4d2505(0x1a1)][_0x382789['room']]&&fs['existsSync'](_0x35bc8f)&&fs['rmdirSync'](_0x35bc8f,{'recursive':!![]}),_0x382789[_0x4d2505(0x1b3)](_0x382789['room']),sendToRoom(_0x382789,{'type':'leave','fromSocketId':_0x382789['id']});}function handleCheckRoom(_0x12da60,_0xea5e97,_0x7fad47){const _0x2ba32b=_0x518acf;let _0x3f159f,_0x9225c0=_0x7fad47[_0x2ba32b(0x1a5)]['adapter'][_0x2ba32b(0x1a1)][_0xea5e97[_0x2ba32b(0x1b6)]];!_0x9225c0||_0x9225c0[_0x2ba32b(0x1b8)]<process[_0x2ba32b(0x1b0)][_0x2ba32b(0x1bf)]?_0x3f159f=!![]:_0x3f159f=![],_0x12da60[_0x2ba32b(0x1bd)](_0x2ba32b(0x1a4),JSON['stringify']({'type':_0x2ba32b(0x197),'result':_0x3f159f,'socketId':_0x12da60['id'],'initiator':!_0x9225c0}));}function sendToRoom(_0x4e244d,_0x410c29){const _0x2369b2=_0x518acf;_0x4e244d[_0x2369b2(0x1c5)]['to'](_0x4e244d['room'])[_0x2369b2(0x1bd)](_0x2369b2(0x1a4),JSON[_0x2369b2(0x19f)](_0x410c29));}function sendToPeer(_0x20b2a7,_0x1b8a05){const _0x3b0ec3=_0x518acf;_0x20b2a7['to'](_0x1b8a05[_0x3b0ec3(0x1c6)])['emit'](_0x3b0ec3(0x1a4),JSON['stringify'](_0x1b8a05));}function handleRecordedChunk(_0xd29335){const _0x21600f=_0x518acf;let _0x51e588=recordingFolder+_0xd29335[_0x21600f(0x1b6)]+_0x21600f(0x1a7);fs['stat'](_0x51e588,function(_0x49cafb,_0x5bad60){const _0x2dad8f=_0x21600f;if(_0x49cafb==null)fileStream[_0x2dad8f(0x1c0)](Buffer[_0x2dad8f(0x1b2)](new Uint8Array(_0xd29335[_0x2dad8f(0x195)])));else _0x49cafb[_0x2dad8f(0x1ac)]===_0x2dad8f(0x1b1)?(fileStream=fs['createWriteStream'](_0x51e588,{'flags':'a'}),fileStream[_0x2dad8f(0x1c0)](Buffer[_0x2dad8f(0x1b2)](new Uint8Array(_0xd29335[_0x2dad8f(0x195)])))):console['log'](_0x2dad8f(0x19e),_0x49cafb[_0x2dad8f(0x1ac)]);});}